let requests_url="https://hexo-circle-of-friends-api.vercel.app/api",moments_container=document.getElementById("moments_container"),orign_data=[],maxnumber=20,addnumber=10,opentype="_blank",append_div=(e,t)=>{if("string"==typeof t){let n=document.createElement("div");n.innerHTML=t;let i=document.createDocumentFragment();for(;n.firstChild;)i.appendChild(n.firstChild);e.appendChild(i)}else e.appendChild(t)},unique=e=>Array.from(new Set(e)),formatDate=e=>{try{let t,n=new Date(Date.parse(e.replace(/-/g,"/")));t=(new Date).getTimezoneOffset()?(new Date).getTimezoneOffset():8;let i=60*t*1e3,o=n.getTime(),s=new Date(o-i),a=s.getSeconds().toString(),l=s.getMinutes().toString();return 1===a.length&&(a="0"+a),1===l.length&&(l="0"+l),s.getFullYear().toString()+"/"+(s.getMonth()+1).toString()+"/"+s.getDate().toString()+" "+s.getHours().toString()+":"+l+":"+a}catch(e){return""}},timezoon=e=>{let t=e[0][1][0][5];return formatDate(t)},todaypost=()=>{let e=new Date,t=e.getFullYear(),n=(e.getMonth()+1).toString(),i=e.getDate().toString();return 1===n.length&&(n="0"+n),1===i.length&&(i="0"+i),t+"-"+n+"-"+i},load_more_post=()=>{maxnumber+=addnumber,moments_container.innerHTML="",data_handle(orign_data,maxnumber)},slice_month=e=>{let t=[],n=[],i=e;for(let e in i){if(i[e].push(e),10!==i[e][1].lenth){let t=i[e][1].split("-");t[1].length<2&&(t[1]="0"+t[1]),t[2].length<2&&(t[2]="0"+t[2]),i[e][1]=t.join("-")}let o=i[e][1].slice(0,7);-1!==t.indexOf(o)?n[t.length-1][1].push(i[e]):(t.push(o),n.push([o,[i[e]]]))}for(let e of n)e.push(e[1][0][6]);return n},data_handle=(e,t)=>{let n=todaypost(),i=new Date(n);for(let t=0;t<e[1].length;t++){new Date(e[1][t][1])>i&&(e[1].splice(t--,1),console.log("穿越了"))}let o,s=0,a=0,l=e[1].slice(0,t),m=e[1].length,r=e[0].length,p=slice_month(l),d=timezoon(p),_=[];for(let t of e[1])t[1]===n&&(s+=1),_.push(t[3]);o=unique(_).length;for(let t of e[0])"true"===t[3]&&(a+=1);let f="<h2>统计信息</h2>";f+='<div id="info_user_pool" class="moments-item info_user_pool" style="">',f+='<div class="moments_chart"><span class="moments_post_info_title">当前友链数:</span><span class="moments_post_info_number">'+r+'个</span><br><span class="moments_post_info_title">失败数:</span><span class="moments_post_info_number">'+a+"个</span><br></div>",f+='<div class="moments_chart"><span class="moments_post_info_title">活跃友链数:</span><span class="moments_post_info_number">'+o+'个</span><br><span class="moments_post_info_title">当前库存:</span><span class="moments_post_info_number">'+m+"篇</span><br></div>",f+='<div class="moments_chart"><span class="moments_post_info_title">今日更新:</span><span class="moments_post_info_number">'+s+'篇</span><br><span class="moments_post_info_title">最近更新:</span><span class="moments_post_info_number">'+d+"</span><br></div>",f+="</div>";for(let e of p){f+="<h2>"+e[0]+"</h2>";for(let t of e[1])f+=' <div class="moments-item">',f+=' <a target="'+opentype+'" class="moments-item-img" href="'+t[2]+'" title="'+t[0]+'">',f+='<img onerror="this.onerror=null,this.src=&quot;https://cdn.jsdelivr.net/gh/Zfour/Butterfly-friend-poor-html/friendcircle/404.png&quot;"',f+=' src="'+t[4]+'"></a>',f+='<div class="moments-item-info"><div class="moments-item-time"><i class="far fa-user"></i>',f+="<span>"+t[3]+"</span>",f+=' <div class="moments_post_time"><i class="far fa-calendar-alt"></i><time datetime="'+t[1]+'" title="'+t[1]+'">'+t[1]+"</time></div>",f+=`</div><a target="${opentype}" class="moments-item-title" href="${t[2]}" title="${t[0]}">${t[0]}</a></div>`,f+="</div>"}e[1].length-t>0&&(f+='<div style="text-align: center"><button type="button" class="moments_load_button" onclick="load_more_post()">加载更多...</button></div>'),f+="<style>.moments-item-info span{padding-left:.3rem;padding-right:.3rem}.moments_post_time time{padding-left:.3rem;cursor:default}.moments_post_info_title{font-weight:700}.moments_post_info_number{float:right}.moments_chart{align-items:flex-start;flex:1;width:100px;height:60px;margin:20px}@media screen and (max-width:500px){.info_user_pool{padding:10px;flex-direction:column;max-height:200px}.moments_chart{flex:0;width:100%;height:160px;margin:0}}.moments-item:before{border:0}@media screen and (min-width:500px){.moments_post_time{float:right}}.moments_load_button{-webkit-transition-duration:.4s;transition-duration:.4s;text-align:center;border:1px solid #ededed;border-radius:.3em;display:inline-block;background:transparent;color:#555;padding:.5em 1.25em}.moments_load_button:hover{color:#3090e4;border-color:#3090e4}.moments-item{position:relative;display:-webkit-box;display:-moz-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-moz-box-align:center;-o-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center;margin:0 0 1rem .5rem;-webkit-transition:all .2s ease-in-out;-moz-transition:all .2s ease-in-out;-o-transition:all .2s ease-in-out;-ms-transition:all .2s ease-in-out;transition:all .2s ease-in-out;box-shadow:rgba(0,0,0,0.07) 0 2px 2px 0,rgba(0,0,0,0.1) 0 1px 5px 0;border-radius:2px}.moments-item-img{overflow:hidden;width:80px;height:80px}.moments-item-img img{max-width:100%;width:100%;height:100%;object-fit:cover}.moments-item-info{-webkit-box-flex:1;-moz-box-flex:1;-o-box-flex:1;box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;padding:0 .8rem}.moments-item-title{display:-webkit-box;overflow:hidden;-webkit-box-orient:vertical;font-size:1.1em;-webkit-transition:all .3s;-moz-transition:all .3s;-o-transition:all .3s;-ms-transition:all .3s;transition:all .3s;-webkit-line-clamp:1}</style>",append_div(moments_container,f)};fetch(requests_url).then(e=>e.json()).then(e=>{orign_data=e,data_handle(orign_data,maxnumber)});